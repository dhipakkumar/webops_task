<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shortest Route Finder</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      font-family: monospace;
      text-align: center;
      background-color: grey;
    }
    #map {
      height: 500px;
      width: 80%;
      margin: 20px auto;
      border: 2px solid #333;
      border-radius: 15px;
    }
    input, button {
      padding: 8px;
      margin: 5px;
      font-size: 16px;
      border-radius: 15px;
    }
  </style>
</head>
<body>
  <h2>Shortest Route Finder</h2>

  <input type="text" id="start" placeholder="START">
  <input type="text" id="end" placeholder="END">
  <p id="result"></p>
  <button onclick="findRoute()">Find Route</button>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let map = L.map("map").setView([20.5937, 78.9629], 5);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

    let routeLayer, originMarker, destinationMarker;

    async function getCoords(place) {
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(place)}`;
      const response = await fetch(url, { headers: { "User-Agent": "dhipak-route-app" }});
      const data = await response.json();
      if (!data.length) throw new Error("Place not found");
      return [parseFloat(data[0].lon), parseFloat(data[0].lat)];
    }

    async function findRoute() {
      const origin = document.getElementById("start").value;
      const destination = document.getElementById("end").value;

      try {
        const originCoords = await getCoords(origin);
        const destinationCoords = await getCoords(destination);
        const res = await fetch("https://api.openrouteservice.org/v2/directions/driving-car", {
          method: "POST",
          headers: {
            "Authorization": "eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImQ0ODkwOGI1ZjM4MjBhNmVkODkzNTA4Y2VjMDA1MzViYWM2NTRkOTI2ZDEzMDQ5YmY0NWE1NDJhIiwiaCI6Im11cm11cjY0In0=" // this is not the way it should be implemented but since we have to use github pages and also since it only supports the frontend part i've temporarily used the api key here :(
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ coordinates: [originCoords, destinationCoords] }),
        });

        const data = await res.json();
        if (!data.routes) {
          document.getElementById("result").innerText = "Error fetching route";
          return;
        }

        const coords = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);
        const distance = (data.routes[0].summary.distance / 1000).toFixed(2);

        document.getElementById("result").innerText = `Distance: ${distance} km`;

        if (routeLayer) map.removeLayer(routeLayer);
        if (originMarker) map.removeLayer(originMarker);
        if (destinationMarker) map.removeLayer(destinationMarker);

        routeLayer = L.polyline(coords, { color: "blue", weight: 4 }).addTo(map);
        originMarker = L.marker([originCoords[1], originCoords[0]]).addTo(map).bindPopup("Origin");
        destinationMarker = L.marker([destinationCoords[1], destinationCoords[0]]).addTo(map).bindPopup("Destination");
        map.fitBounds(routeLayer.getBounds());
      } catch (err) {
        document.getElementById("result").innerText = "Error: " + err.message;
        console.error(err);
      }
    }
  </script>
</body>
</html>
