<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Shortest Route Finder</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <style>
         body { font-family: monospace; text-align: center; background-color: grey; }
         #map { height: 500px; width: 80%; margin: 20px auto; border: 2px solid #333; border-radius: 15px; }
         input, button { padding: 8px; margin: 5px; font-size: 16px; boarder-radius:15px; }
        </style>
    </head>
    <body>
        <h2>Shortest Route Finder</h2>
        <input type="text" id="start" placeholder="START">
        <input type="text" id="end" placeholder="END">
        <p id = "result"></p>
        <button onclick="findRoute()">Find Route</button>
        <h3 id="result"></h3>
        <div id="map"></div>
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <script>
        let map = L.map("map").setView([20.5937, 78.9629], 2);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
        let routeLayer, originMarker, destinationMarker;
        async function findRoute(){
             console.log("the button is pressed");
             const origin = document.getElementById("start").value;
             const destination = document.getElementById("end").value;
             const response = await fetch("/api/route",{
                 // this way it gets connected to the server.js's introduction to the api/route path..
                 method: "POST", headers: { "Content-Type": "application/json" },
                 body: JSON.stringify({ origin, destination }),
             });
             const data = await response.json();
             console.log(data);
             if (data.error){
                 document.getElementById("result").innerText = "Error: " + data.error;
                 return;
             }
             const distance = (data.summary.distance / 1000).toFixed(2);
             document.getElementById("result").innerText = `Distance: ${distance} km`;
             if (routeLayer) map.removeLayer(routeLayer);
             if (originMarker) map.removeLayer(originMarker);
             if (destinationMarker) map.removeLayer(destinationMarker);
             // Convert coordinates [lng, lat] â†’ [lat, lng]
             const coords = data.coordinates.map(c => [c[1], c[0]]);
             // Draw route
             routeLayer= L.polyline(coords, { color: "blue", weight: 4 }).addTo(map);
             // Add origin and destination markers
             originMarker = L.marker([data.origin[1], data.origin[0]]).addTo(map).bindPopup("Origin");
             destinationMarker = L.marker([data.destination[1], data.destination[0]]).addTo(map).bindPopup("Destination");
             // Zoom map to fit route
             map.fitBounds(routeLayer.getBounds());
             console.log("Coords:", data.coordinates);
             console.log("Origin:", data.origin);
             console.log("Destination:", data.destination);
         }
        </script>
    </body>
</html>
